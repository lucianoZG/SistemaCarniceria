<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Registrar Inventario</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <body class="d-flex flex-column min-vh-100 bg-light">

        <!-- Navbar -->
        <div th:replace="fragments/navbar :: navbar('inventarios')"></div>

        <div class="container mt-5">
            <h2 class="mb-4 text-center">Registro de Inventario</h2>

            <form id="inventarioForm" th:action="@{/inventarios}" method="post">

                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label for="productoSelect" class="form-label">Producto</label>
                        <select id="productoSelect" class="form-select">
                            <option value="">Seleccione un producto...</option>
                            <option th:each="p : ${productos}" th:value="${p.id}" th:text="${p.descripcion}"></option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label for="stockRelevado" class="form-label">Stock relevado</label>
                        <input type="number" id="stockRelevado" class="form-control" min="0">
                    </div>

                    <div class="col-md-3">
                        <button type="button" id="agregarBtn" class="btn btn-primary w-100">Agregar</button>
                    </div>
                </div>

                <hr class="my-4">

                <table class="table table-striped" id="tablaInventario">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Stock relevado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-success">Registrar Inventario</button>
                </div>
            </form>
        </div>

        <script>
            $(document).ready(function () {
                $('#agregarBtn').click(function () {
                    const productoId = $('#productoSelect').val();
                    const productoTexto = $('#productoSelect option:selected').text();
                    const stockRelevado = $('#stockRelevado').val();

                    if (!productoId || !stockRelevado) {
                        alert('Seleccione un producto e ingrese un stock relevado.');
                        return;
                    }

                    const fila = `
                        <tr>
                            <td>
                                ${productoTexto}
                                <input type="hidden" name="productoId" value="${productoId}">
                            </td>
                            <td>
                                ${stockRelevado}
                                <input type="hidden" name="stockRelevado" value="${stockRelevado}">
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger btn-sm eliminarBtn">Eliminar</button>
                            </td>
                        </tr>
                    `;
                    $('#tablaInventario tbody').append(fila);

                    $('#productoSelect').val('');
                    $('#stockRelevado').val('');
                });

                $(document).on('click', '.eliminarBtn', function () {
                    $(this).closest('tr').remove();
                });
            });
        </script>

        <!-- Footer -->
        <footer class="mt-auto">
            <div th:replace="fragments/footer :: footer"></div>
        </footer>

    </body>
</html>
